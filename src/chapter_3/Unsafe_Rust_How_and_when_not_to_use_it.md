# ã€Œè¯‘ã€Unsafe Rust çš„å–èˆ

è¯‘è€…ï¼š

åŸæ–‡ï¼š[Unsafe Rust: How and when (not) to use it](https://blog.logrocket.com/unsafe-rust-how-and-when-not-to-use-it/)

## ä»€ä¹ˆæ—¶å€™ä¸è¯¥ç”¨ `unsafe`


é€šå¸¸, `unsafe` å®é™…ä¸Šæ˜¯åœ¨è¿½æ±‚æ€§èƒ½çš„è¿‡ç¨‹ä¸­ä½¿ç”¨çš„ã€‚ä½†æ˜¯ï¼Œæ­£å¦‚æˆ‘åœ¨ [How to write CRaP Rust code](https://blog.logrocket.com/how-to-write-crap-rust-code) ä¸­æ‰€å†™çš„é‚£æ ·ï¼Œå³ä½¿åªæ˜¯ä½œä¸ºè¦æµ‹è¯•çš„å¿«ç…§å’Œä½œä¸ºåŸºå‡†è¿›è¡ŒåŸºå‡†æµ‹è¯•ï¼Œä¹Ÿåº”è¯¥å§‹ç»ˆè¿è¡Œè¾ƒæ…¢ä½†æ˜¯å®‰å…¨çš„ç‰ˆæœ¬ã€‚ 

åªæ˜¯å› ä¸ºä½¿ç”¨ `unsafe` çš„ä»£ç æœ‰æ—¶å¯ä»¥æ›´å¿«ï¼Œå¹¶ä¸æ„å‘³ç€ä¸€å®šè¦è¿™æ ·åšã€‚åˆç†çš„è¯„ä¼°æƒ…å†µ, åœ¨ä¿æŒåŸæœ‰é€Ÿåº¦æˆ–è€…æ›´å¿«çš„æ—¶å€™, å°±åº”è¯¥ç»§ç»­ä½¿ç”¨ `safe` ç‰ˆæœ¬çš„ä»£ç ã€‚

ä¾‹å¦‚ï¼Œåœ¨å°è¯•åŠ å¿« [Benchmark Game](https://benchmarksgame-team.pages.debian.net/benchmarksgame/) æ¡ç›®ä¹‹ä¸€ä½œä¸ºç»ƒä¹ æ—¶ï¼Œæˆ‘æƒ³é€šè¿‡ä½¿ç”¨æ•°ç»„è€Œä¸æ˜¯ `Vec` æ¥å‡å°‘å†…å­˜åˆ†é…ï¼Œè¿™éœ€è¦ä¸€äº›ä¸å®‰å…¨çš„ä»£ç æ¥å¤„ç†æœªåˆå§‹åŒ–çš„æ•°æ®ã€‚ä½†æ˜¯ï¼Œäº‹å®è¯æ˜æ”¹ç”¨æ•°ç»„çš„ç‰ˆæœ¬è¦æ¯”åŸºäº `Vec` çš„ç‰ˆæœ¬æ…¢ï¼Œå› ä¸ºè¿™ä¸ªæˆ‘å°±æ²¡ç»§ç»­ä¸‹å»äº†ã€‚å…‹é‡Œå¤«Â·æ¯”ä½›å°”ï¼ˆ Cliff L. Biffle ï¼‰åœ¨ [Benchmark Game](https://benchmarksgame-team.pages.debian.net/benchmarksgame/) ä¸€ä¹¦ä¸­ä¹Ÿè°ˆåˆ°äº†ç±»ä¼¼çš„ç»å†ã€‚ ä½¿ç”¨ `unsafe` ä¸ä»…ä¼šè®©ç¼–è¯‘å™¨å‡å°‘å¯¹ä»£ç çš„å®‰å…¨æ€§çš„ä¿è¯ï¼Œä¹Ÿå‡å°‘äº†è¦åšçš„æ£€æŸ¥,å› æ­¤å®é™…ä¸Šå¯èƒ½ä¼šç¦ç”¨æŸäº›ä¼˜åŒ–ä»¥é¿å…ç ´åä»£ç ã€‚å› æ­¤ï¼Œåœ¨åˆ‡æ¢åˆ° `unsafe` ä¹‹å‰ï¼Œè¯·åŠ¡å¿…å…ˆè¿›è¡Œè¯„ä¼°ï¼Œè¿›å°½é‡ä¿æŒ  `safe` çš„ä»£ç ã€‚ 

å¥½çš„ï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ï¼



### å¤„ç†æœªåˆå§‹åŒ–çš„å†…å­˜

 

å½“ Rust ç‰ˆæœ¬æ›´æ–°åˆ°1.0.0æ—¶ï¼Œæ ‡å‡†åº“æœ‰ä¸€ä¸ª `unsafe` å‡½æ•°æ¥è·å–æœªåˆå§‹åŒ–çš„å†…å­˜: `std::mem::uninitialized` (è¿˜æœ‰ `std::mem::zeroed`ï¼ˆï¼‰ï¼Œä½†æ˜¯ä¸¤è€…ä¹‹é—´çš„å”¯ä¸€åŒºåˆ«æ˜¯ åè€…å°†è¿”å›çš„å†…å­˜åŒºåŸŸç”¨0åˆå§‹åŒ–)ã€‚ 

äººä»¬æ™®éè®¤ä¸ºè¿™æ˜¯ä¸ªåä¸»æ„ï¼Œç°åœ¨è¯¥å‡½æ•°å·²ç»å¤„äºåºŸå¼ƒ (`deprecated`) çŠ¶æ€ï¼Œå»ºè®®ä½¿ç”¨`std::mem::MaybeUnit` ç±»å‹ä»£æ›¿ã€‚ æœªåˆå§‹åŒ–çš„éº»çƒ¦çš„åŸå› æ˜¯ï¼Œè¯¥å€¼å¯èƒ½ä¼šåœ¨ææ…Œ (`panic`)æˆ–åœ¨ä¹‹å‰è¿”å›æ—¶éšå¼åˆ é™¤ã€‚ ä¾‹å¦‚ï¼š

````rust
let x = std::mem::uninitialized();
this_function_may_panic();
mem::forget(x);
````



å¦‚æœ `this_function_may_panic` å‡½æ•°å®é™…ä¸Š `panic ` äº†ï¼Œåˆ™xä¼šåœ¨æˆ‘ä»¬è°ƒç”¨ `forget` ä¹‹å‰å°±è¢« `drop` ã€‚ä½†æ˜¯ï¼Œåˆ é™¤æœªåˆå§‹åŒ–çš„å€¼æ˜¯æœªå®šä¹‰çš„è¡Œä¸ºï¼Œå¹¶ä¸”ç”±äºåˆ é™¤é€šå¸¸æ˜¯éšå¼çš„ï¼Œå› æ­¤å¾ˆéš¾é¿å…è¿™ç§æƒ…å†µã€‚å› æ­¤ï¼Œ `MaybeUninit` è¢«è®¾è®¡ä¸ºèƒ½å¤Ÿå¤„ç†æ½œåœ¨çš„æœªåˆå§‹åŒ–æ•°æ®ã€‚è¯¥ç±»å‹æ°¸è¿œä¸ä¼šè‡ªåŠ¨ `drop` ï¼ˆå¦‚ `std::mem::ManuallyDrop` ï¼‰ï¼Œç¼–è¯‘å™¨çŸ¥é“è¯¥ç±»å‹å¯èƒ½æœªåˆå§‹åŒ–ï¼Œå¹¶ä¸”å…·æœ‰è®¸å¤šå‡½æ•°æ¥æ­£ç¡®å¤„ç†æœªåˆå§‹åŒ–çš„æ•°æ®ã€‚ 

è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹ã€‚æˆ‘ä»¬å¯èƒ½ä¸ä¼šè°ƒç”¨ `std::ptr::read` å»è¯»æœªåˆå§‹åŒ–å†…å­˜ã€‚æˆ‘ä»¬ç”šè‡³ä¸èƒ½å¼•ç”¨å®ƒï¼ˆ `&` æˆ–è€… `&mut` ï¼‰ï¼Œå› ä¸ºå¼•ç”¨è§„åˆ™è¦æ±‚å¼•ç”¨çš„å€¼å¿…é¡»æ˜¯å¼•ç”¨ç±»å‹çš„æœ‰æ•ˆå®ä¾‹ï¼Œè€Œæœªåˆå§‹åŒ–çš„æ•°æ®ä¸æ˜¯è¿™ç§æƒ…å†µ(é™¤äº†ä½¿ç”¨ `MaybeUninit<_>` ï¼Œå› ä¸ºè¿™æ˜¾ç„¶ä¸éœ€è¦åˆå§‹åŒ–ï¼‰ã€‚ 

å› æ­¤ï¼Œæˆ‘ä»¬ä¹Ÿä¸åº”è¯¥ `drop`ï¼Œå› ä¸ºè¿™ä¼šåˆ›å»ºä¸€ä¸ªå¯å˜çš„å¼•ç”¨ï¼ˆæ³¨æ„ï¼Œ`fn drop(&mut self))` ã€‚æˆ‘ä»¬å¯ä»¥å°†å…¶è½¬æ¢ä¸ºå…¶ä»–å…è®¸å‚¨å­˜æœªåˆå§‹åŒ–æ•°æ®çš„ç±»å‹( åˆ›å»ºä¸€ä¸ªæœªåˆå§‹åŒ–çš„æ•°ç»„è¿˜æ˜¯æœ€ç®€æ´çš„æ–¹æ³•)æˆ–ç”¨ `std :: ptr :: write`  åˆ°ä»  `as_mut_ptr()` æ–¹æ³•è·å¾—çš„æŒ‡é’ˆï¼Œåˆæˆ–è€…ä½¿ç”¨ `MaybeUninit` ç­‰ç­‰ã€‚è¯·æ³¨æ„ï¼Œå³ä½¿ç±»å‹æœªåˆå§‹åŒ–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ†é…ç»™ `MaybeUninit` ï¼Œå› ä¸ºç±»å‹ä¸ä¼š `drop` ã€‚ 

ä¸¾ä¾‹æ¥è¯´ï¼Œå‡è®¾æˆ‘ä»¬è¦ä½¿ç”¨ä¸€ä¸ªå‡½æ•°åˆ›å»ºä¸€ä¸ªå€¼æ•°ç»„ã€‚æ•°ç»„çš„æ²¡æœ‰å®ç° `Copy` æˆ–æ²¡æœ‰const çš„ `initializer` ï¼Œæˆ–è€… [LLVM](https://en.wikipedia.org/wiki/LLVM)  ç”±äºæŸç§åŸå› æ— æ³•ä¼˜åŒ– `double` ã€‚è¿™ç§æ—¶å€™å°±ç”¨ `unsafe` ï¼š 

````rust
use std::mem::{MaybeUninit, transmute};

unsafe {
    // first part: initialize the array. This is one of the rare cases where
    // directly calling `assume_init` is OK, because an array of
    // `MaybeUninit` may contain uninitialized data.
    
    // ç¬¬ä¸€éƒ¨åˆ†: åˆå§‹åŒ–è¿™ä¸ªæ•°ç»„ã€‚è¿™ç§å°±æ˜¯å‡ ç§ç‰¹æ®Šæƒ…å†µä¹‹ä¸€ï¼Œç›´æ¥
    // è°ƒç”¨ `assume_init` æ˜¯å¯è¡Œçš„,å› ä¸º `MaybeUninit` å¯ä»¥æ”¾æœªåˆ		// å§‹åŒ–æ•°ç»„
    let mut array: [MaybeUninit<MyType>; 256] =
        MaybeUninit::uninit().assume_init();

    // second part: initialize the data. This is safe because we assign
    // to a `MaybeUninit`, which is exempt from `drop`.
    
    //  ç¬¬äºŒéƒ¨åˆ†: åˆå§‹åŒ–æ•°æ®ã€‚å› ä¸º `Maybeuninit` é¿å…äº† `drop`
    for (i, elem) in array.iter_mut().enumerate() {
        *elem = MaybeUninit::new(calculate_elem(i));
    }

    // third part: transmute to the initialized array. This works because
    // `MaybeUninit<T>` is guaranteed to have the same Layout as `T`.
    
   // ç¬¬ä¸‰éƒ¨åˆ†: è½¬æ¢æˆåˆå§‹åŒ–è¿‡çš„æ•°ç»„ã€‚è¿™æ˜¯å¯è¡Œçš„ï¼Œå› ä¸º `MaybeUninit<T>` ä¿è¯äº†æ•°æ®å¡«å……æ˜¯å’Œ `T` ä¸€è‡´çš„
    transmute::<_, [MyType; 256]>(array)
}
````

å¦‚æœä»»ä½• `calculate_elem(_)` è°ƒç”¨å¤±è´¥ï¼Œåˆ™å°†åˆ é™¤æ•´ä¸ª `MaybeUninits` æ•°ç»„ã€‚ å› ä¸º `MaybeUninit` ä¸ä¼š `drop` ï¼Œæ‰€ä»¥ç°åœ¨æ‰€æœ‰çš„æ•°æ®éƒ½å°†æ³„æ¼ã€‚

ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬åº”è¯¥åŠ å…¥é¢å¤–çš„ç§»åŠ¨è¯­ä¹‰çš„éƒ¨åˆ†:

````rust
use std::mem::{forget, MaybeUninit, transmute};

// first extra part: We need a "guard" that drops all *initialized* elements
// on drop

// åŠ å…¥çš„ç¬¬ä¸€ä¸ªé¢å¤–éƒ¨åˆ†: æˆ‘ä»¬éœ€è¦ä¸€ä¸ª "guard"(å®ˆæŠ¤) æ¥é”€æ¯æ‰€æœ‰åˆå§‹åŒ–è¿‡çš„å…ƒç´ 

struct Guard<'a> {
    // a mutable ref to access the array from
    array: &'a mut [MaybeUninit<MyType>; 256],
    // the index until which all elements are initialized
    index: usize,
    // ä¸€ä¸ªå¯å˜å¼•ç”¨å…è®¸ç”¨ç´¢å¼•è®¿é—®,ä½¿å¾—æ‰€æœ‰å…ƒç´ éƒ½è¢«åˆå§‹åŒ–
}

impl Drop for Guard<'_> {
    // drop all elements that are initialized
    // é”€æ¯æ‰€æœ‰è¢«åˆå§‹åŒ–çš„å…ƒç´ 
    fn drop(&mut self) {
        for i in 0..self.index {
            unsafe {
                std::ptr::drop_in_place(self.array[i].as_mut_ptr());
            }
        }
    }
}

unsafe {
    let mut array: [MaybeUninit<MyType>; 256] =
        MaybeUninit::uninit().assume_init();

    // second extra part: here we initialize the guard. From here on, it
    // borrows our array mutably. All access will be done through the guard
    // (because the borrow checker won't let us access `array` directly
    // while it's mutably borrowed).
    
    // åŠ å…¥çš„ç¬¬äºŒä¸ªé¢å¤–éƒ¨åˆ†: è¿™é‡Œæˆ‘ä»¬ç”¨ `&mut array` åˆå§‹åŒ–äº† `guard`ã€‚
    // (å½“ä½¿ç”¨å¯å˜å€Ÿç”¨æ—¶ï¼Œå€Ÿç”¨æ£€æŸ¥å™¨å¹¶ä¸è®©æˆ‘ä»¬ç›´æ¥è®¿é—®æ•°ç»„)
    let mut guard = Guard { array: &mut array, index: 0 };
    for i in 0..256 {
        guard.array[guard.index] = MaybeUninit::new(calculate_elem(i));
        // update the index so `drop` will include the newly created element.
        // æ›´æ–°ç´¢å¼•ï¼Œä½¿å¾—åŒ…å«æ–°åˆ›å»ºçš„å…ƒç´ 
        guard.index += 1;
    }
    // third extra part: forget the guard to avoid dropping the initialized
    // elements and also end the borrow.
    
    // åŠ å…¥çš„ç¬¬ä¸‰éƒ¨åˆ†: è°ƒç”¨ `forget` ,é”€æ¯ `guard`ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼
    forget(guard);

    transmute::<_, [MyType; 256]>(array)
}
````

å¦‚æœä½ è®¤ä¸ºåªæ˜¯ä¸ºäº†åˆå§‹åŒ–æ•°ç»„å±…ç„¶å°±éœ€è¦è¿™ä¹ˆå¤šæ­¥éª¤ï¼Œä½ æ˜¯å¯¹çš„ã€‚åŒæ ·ï¼Œåœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œä¸€å®šè¦è¡¡é‡å¯¹æ€§èƒ½çš„å½±å“ã€‚å½“ç„¶ä¸æ˜¯å’Œ `Vec <MyType>` æ¯”ã€‚ 

æ— è®ºå¦‚ä½•ï¼Œè¿™æ˜¾ç¤ºäº†å¤„ç†æœªåˆå§‹åŒ–æ•°æ®çš„è§„èŒƒæ–¹æ³•ï¼šæ ‡å¿—ä¸€ä¸ªä¸å˜é‡(â€œåœ¨`index` ä¹‹å‰çš„éƒ½åº”è¯¥ä¸å¯å˜ â€)ï¼Œå¯¹å…¶è¿›è¡Œç»´æŠ¤(â€œå†™å…¥ä¸€ä¸ªå…ƒç´ åç´¢å¼•å¢åŠ â€)ï¼Œä½ å¯ä»¥ä»ä¸­å—ç›Šâ€”â€”åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ`panic` æ—¶ä¹Ÿä¸ä¼šå‘ç”Ÿæ³„æ¼ã€‚ 

è¿™ç§æ–¹æ³•ä¹Ÿé€‚ç”¨äºå…¶ä»–æ•°æ®ç»“æ„ï¼Œä½†é‚£é‡Œé€šå¸¸ä½¿ç”¨ä¸åŒçš„ä¸å˜é‡ã€‚ä¾‹å¦‚ï¼Œ`Vec` åœ¨ `resize` æ“ä½œå‰, å°†å†…å­˜æ‹·è´ä¸€ä»½æ”¾åœ¨åå¤‡å†…å­˜é‡Œï¼Œå¹¶å°†é•¿åº¦è®¾ç½®ä¸ºé›¶ï¼Œå¹¶åœ¨æ“ä½œå®Œæˆåå°†å…¶æ¢å¤(å‘ç”Ÿæ³„æ¼æ—¶,æ³„æ¼çš„å†…å­˜å…¶å®æ˜¯æ¯” `vec` é•¿åº¦è¦å¤§çš„)ã€‚è¿™ç¡®ä¿äº† `drop` ä¸ä¼šç”¨åœ¨æœªåˆå§‹åŒ–æˆ–å·²ç»é‡Šæ”¾çš„å†…å­˜ä¸Šã€‚ 

å–å†³äºä¸åŒçš„æ•°æ®æœºæ„ï¼Œè¿™ä¸ªä¸å˜é‡å°†å˜çš„æ™¦æ¶©éš¾æ‡‚ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ª `bit set` å¯¹åˆå§‹åŒ–çš„å…ƒç´ è¿›è¡Œç¼–ç ï¼Œå› æ­¤éœ€è¦æ¯”æ™®é€šæ•°ç»„å¤šå…«åˆ†ä¹‹ä¸€çš„å†…å­˜ï¼Œä½†å…è®¸éšæœºè®¿é—®ä»»æ„å…ƒç´ ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†æ˜¯â€œåˆå§‹åŒ–å’Œ `bit set` ä¸€ä¸€å¯¹åº”â€ã€‚ Rustçš„` HashMaps` åŸºæœ¬ä¸Šæ˜¯è¿™æ ·åšçš„ã€‚

> è¯‘è€…æ³¨:  bit set å…¶å®å°±æ˜¯ä½ç¤ºå›¾æ³•



### ä¸å¯å˜çš„è½¬æ¢

Rustå…³äºå¼•ç”¨çš„è§„åˆ™éå¸¸ä¸¥æ ¼â€”â€”åœ¨æ¯ä¸ªç»™å®šçš„æ—¶é—´ç‚¹å¯ä»¥è¯»å–æˆ–å†™å…¥å¤šå°‘å˜é‡ã€‚ ä½†æ˜¯æœ‰æ—¶å€™æˆ‘ä»¬ç¡®å®éœ€è¦ç¨å¾®æ”¹å˜è§„åˆ™ã€‚ 

ä¸ºæ­¤ï¼ŒRustä¸ºå†…éƒ¨å¯å˜æ€§æä¾›äº†ä¸€ç§(æ˜¾ç„¶å¾—ç”¨ `unsafe`)ç±»å‹ï¼Œå®ƒå¯ä»¥ä½¿ç”¨ `get(ï¼†self)`æ–¹æ³•ä»ä¸å¯å˜çš„å€Ÿé¡¹ä¸­è·å¾—ä¸€ä¸ªå¯å˜çš„æŒ‡é’ˆ(å½“ç„¶ä¸æ˜¯å¼•ç”¨)ã€‚ è¿˜æœ‰ä¸€ä¸ª`get_mut(&mut self)` çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å‘å†…å®¹è¿”å›å¯å˜çš„å€Ÿç”¨ã€‚ 

è¿™æ„å‘³ç€ç¼–è¯‘å™¨å°†å‡å®šæ‰€æœ‰ `UnsafeCell` ä¸­çš„å†…å®¹éƒ½è¢«å¼•ç”¨äº†ã€‚ æ ‡å‡†åº“åœ¨é¡¶å±‚æä¾›äº†è®¸å¤šå®‰å…¨æŠ½è±¡ï¼Œç‰¹åˆ«æ˜¯ `Cell`ï¼Œ`RefCell` ï¼Œ`RwLock` ï¼Œ`Mutex` å’Œå„ç§`Atomic*`ç±»å‹ã€‚ 

> è¯‘è€…æ³¨: Atomic* çš„æ„æ€æ˜¯ä»¥Atomicå¼€å¤´çš„ç±»å‹ , è¿™æ˜¯[æ­£åˆ™è¡¨è¾¾å¼](https://zh.wikipedia.org/wiki/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F)çš„ä¸€ç§

ä¾‹å¦‚ï¼Œ[AtomicBool](https://doc.rust-lang.org/std/sync/atomic/struct.AtomicBool.html) çš„å®šä¹‰å¦‚ä¸‹(ä¸ºç®€æ´èµ·è§åˆ é™¤äº†æ³¨é‡Š)ï¼š 

````rust
pub struct AtomicBool {
    v: UnsafeCell<u8>,
}
````

å½“ç„¶ï¼Œè¯¥å®ç°å¿…é¡»ç¡®ä¿é¿å…æ•°æ®ç«äº‰(æ˜¯æŒ‡åœ¨éçº¿ç¨‹å®‰å…¨çš„æƒ…å†µä¸‹ï¼Œå¤šçº¿ç¨‹å¯¹åŒä¸€ä¸ªåœ°å€ç©ºé—´è¿›è¡Œå†™æ“ä½œ)ï¼Œé€šè¿‡ LLVM å†…éƒ¨å‡½æ•°ä½¿ç”¨å®é™…çš„åŸå­æ“ä½œæ¥å®Œæˆçš„ã€‚ æˆ‘è¿˜æ²¡æœ‰æ£€æŸ¥å³å°†åˆ°æ¥çš„  [Cranelift](https://github.com/bytecodealliance/cranelift) åç«¯çš„åŠŸèƒ½ï¼Œä½†å®ƒä¼¼ä¹ä¹Ÿæœ‰æŸç§ç±»ä¼¼çš„å®ç°ã€‚ åŒæ ·ï¼Œåœ¨ç›´æ¥ä½¿ç”¨ `UnsafeCell` ä¹‹å‰ï¼Œè¯·æ£€æŸ¥æ˜¯å¦æœ‰ä»»ä½• `safe` çš„æ›¿ä»£å“å¯ç”¨ï¼Œè™½ç„¶ç¡®å®š `unsafe` æ˜¯å¦ä¼šç»™ä½ å¸¦æ¥è¶³å¤Ÿçš„æ€§èƒ½æå‡(æˆ–å…¶ä»–å¥½å¤„)ã€‚ 



### ä½¿ç”¨CPUçš„ç‰¹æœ‰æŒ‡ä»¤é›†

Rustçš„æ ‡å‡†åº“åœ¨`std:: arch` æ¨¡å—ä¸­æœ‰æŒ‰CPUç±»å‹åˆ†ç±»çš„å›ºæœ‰å‡½æ•°ã€‚å®ƒä»¬éƒ½è¢«å®šä¹‰ä¸º `unsafe` çš„ï¼Œä¸»è¦æ˜¯å› ä¸ºå®ƒä»¬å¯èƒ½æœªåœ¨ä½ çš„CPUä¸Šå®ç°ã€‚ å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€ç§è§„èŒƒçš„æ–¹æ³•å¯ä»¥ç¡®ä¿ä½ åœ¨ç¼–è¯‘æ—¶æˆ–è¿è¡Œæ—¶æ‹¥æœ‰ç›¸åº”çš„CPUã€‚ 

å‡è®¾ä½ ä»¥"æ ‡å‡†"çš„æ–¹å¼ç¼–å†™äº†ç®—æ³•ï¼Œçœ‹äº†ç”Ÿæˆçš„æ±‡ç¼–ï¼Œè§‰å¾—ç¼–è¯‘å™¨ç”Ÿæˆçš„ä»£ç ä¸å¤Ÿå¥½ã€‚æ˜¯æ—¶å€™æå‡º"å± é¾™åˆ€"äº†ã€‚ ä½†åŸºæœ¬ä¸Šå°±æ˜¯åœ¨ Rust é‡Œç¼–å†™æ±‡ç¼–äº†(å› ä¸º `arch` å†…éƒ¨å‡½æ•°æ˜¯å’Œä¸åŒæ¶æ„ä¸€ä¸€å¯¹åº”çš„)ã€‚ å¦‚ä¸Šæ‰€è¿°ï¼Œä½ éœ€è¦ç¡®ä¿ç”¨æˆ·çš„å¹³å°å’Œä½ çš„ä¸€è‡´ã€‚ ä»¥ä¸‹ä»£ç æ˜¾ç¤ºäº†åœ¨ç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶æ£€æŸ¥ CPUæ˜¯å¦æ”¯æŒçš„æ–¹æ³•ï¼š

````rust
// compile time check ç¼–è¯‘æ—¶æ£€æŸ¥
#[cfg(any(target_arch = "x86", target_arch = "x86_64"))]
mod simd {
    fn calculate() -> .. {
        // this is a std library macro that allows us to safely access CPU
        // features by doing runtime detection
        // è¿™é‡Œæ˜¯æ ‡å‡†åº“çš„ä¸€ä¸ªå®ï¼Œé€šè¿‡å®ƒæˆ‘ä»¬å¯ç”¨è¿›è¡ŒCPUçš„ç¼–è¯‘å™¨æ£€æŸ¥
        
        if is_x86_feature_detected!("avx2") {
            // code using avx2 intrinsics here
        } else if is_x86_feature_detected!("sse2")
            // code using sse2 intrinsics here
        } else {
            // code using no special features, using e.g. avx2 intrinsics
            // would be UB!
        }
    }
}

#[cfg(not(any(target_arch = "x86", target_arch = "x86_64")))]
mod simd {
    // fallback code here
}
````

æ­¤ç¤ºä¾‹ä»…å…·æœ‰é’ˆå¯¹x86å’Œx86_64æ¶æ„çš„ä¸“ç”¨ä»£ç ï¼Œä»¥åŠå„ç§è¿è¡Œæ—¶æ£€æµ‹åˆ°çš„CPUåŠŸèƒ½ã€‚ å¦‚æœä½ å¸Œæœ›ç¨‹åºåœ¨å…¶ä»–å¹³å°(ä¾‹å¦‚ARM-NEON)ä¸Šä½¿ç”¨SIMDå†…éƒ¨å‡½æ•°ï¼Œåˆ™éœ€è¦æ·»åŠ å¦ä¸€ä¸ª `#[cfg]` å£°æ˜ã€‚ä¸ç”¨å¤šè¯´ï¼Œæœ€åä½ å°±å¾—å†™ä¸Šä¸å°‘ä»£ç ã€‚

 é™¤äº†å¯ç”¨æ€§ä¹‹å¤–ï¼Œä¸€äº›æŒ‡ä»¤è¿˜è¦è€ƒè™‘å†…å­˜å¯¹é½ã€‚ ä¸ºäº†ç®€åŒ– `bit` ï¼Œå†…å­˜å¯¹é½å‘Šè¯‰æˆ‘ä»¬æœ‰äº›åœ°å€çš„æœ€åå‡ ä½å¿…é¡»ä¸ºé›¶ã€‚ ä¾‹å¦‚ï¼Œä¸€ä¸ª32ä½å€¼çš„å¯¹é½æ–¹å¼å¯èƒ½ä¸º `4` ï¼Œè¿™æ„å‘³ç€å…¶åœ°å€çš„æœ€åä¸¤ä½åº”ä¸ºé›¶ã€‚ è¯·å‚é˜…åº“æ–‡æ¡£ä»¥è·å–è¯¦ç»†ä¿¡æ¯ï¼Œå¹¶å‚è€ƒ [ä¸Šä¸€ç« ]() ä»¥è·å–é€‚å½“çš„å¸®åŠ©ã€‚

### å†…è”æ±‡ç¼–

å‡è®¾ä½ æ­£åœ¨ç¼–å†™å†…æ ¸ï¼Œå¹¶ä¸”éœ€è¦ä½¿ç”¨å †æ ˆæŒ‡é’ˆæ¥å¤„ç†ä¸€äº›"å¥‡æ€ª"çš„äº‹æƒ…ï¼Œæˆ–è€…å…¶ä»–ä¸å¾—ä¸éœ€è¦ç”¨æ±‡ç¼–çš„åœ°æ–¹ã€‚ Rustæœ‰ä¸¤ä¸ª `FFI` æ¥å£ï¼šä¸€ä¸ªæ˜¯Cè¯­è¨€ï¼Œå¦ä¸€ä¸ªæ˜¯æ±‡ç¼–ã€‚ ä¸å¹¸çš„æ˜¯ï¼Œè¿™æ—¢ä¸ç¨³å®šåˆä¸å®‰å…¨ï¼Œæ‰€ä»¥ä½ å°±å¾—ä½¿ç”¨`nightly` ç‰ˆæœ¬æ¥ç¼–è¯‘`#[feature(asm)]` å’Œ `unsafe` çš„å—ã€‚ æ˜¾ç„¶ï¼ŒRustæ— æ³•æ£€æŸ¥ä½ åœ¨æ±‡ç¼–ä¸­æ‰€åšçš„äº‹æƒ…ã€‚ ä½¿ç”¨å†…è”æ±‡ç¼–çš„ç»†èŠ‚ä¸åœ¨æœ¬æ–‡è®¨è®ºèŒƒå›´ä¹‹å†…ã€‚ è¯·æŸ¥çœ‹ [Rust Book chapter](https://doc.rust-lang.org/1.8.0/book/inline-assembly.html)  æˆ–è€… [RFC text](https://rust-lang.github.io/rfcs/2873-inline-asm.html)ã€‚ å°±æœ¬æ–‡è€Œè¨€ï¼Œä¸éœ€è¦ä½ ç†Ÿæ‚‰ `FFI` ã€‚ 

### ä¸å…¶ä»–è¯­è¨€äº¤äº’

å‡å¦‚ä½ æœ‰éå¸¸åºå¤§çš„ C ä»£ç åº“ï¼Œå¹¶å¸Œæœ›å°†å…¶ç§»è‡³ Rustï¼Œä¸ç”¨å¤šè¯´ï¼Œè¿™æ˜¯ä¸€é¡¹è‰°å·¨çš„ä»»åŠ¡ã€‚ä½ å¯ä»¥å…ˆä½¿ç”¨å¤–éƒ¨å‡½æ•°æ¥å£æ¥é‡å†™ä»£ç åº“çš„ä¸€å°éƒ¨åˆ†ï¼Œç„¶åé€ä¸ªæ¨¡å—è¿›è¡Œé‡å†™ï¼Œç›´åˆ°æ•´ä¸ªç¨‹åºéƒ½ç”¨ Rust ç¼–å†™ï¼Œç„¶åä½ å°±å¯ä»¥æ‰”æ‰Cäº†(ğŸ˜€)(é¡ºå¸¦ä¸€è¯´ [librsvg](https://people.gnome.org/~federico/blog/a-rust-api-for-librsvg.html) å°±æ˜¯è¿™æ ·åšçš„)ã€‚æˆ–è€…åœ¨ C ++ ä¸­ä½¿ç”¨ Rustã€‚ 

æ— è®ºå¦‚ä½•ï¼Œä½ éƒ½å¾—åœ¨å®‰å…¨çš„ï¼Œå……æ»¡æ¸©æš–çš„ Rust ä¸–ç•Œä¸è‰°éš¾è€Œåˆæ— æƒ…çš„ä¸–ç•Œä¹‹é—´æ¶èµ·ä¸€åº§æ¡¥æ¢ã€‚æ—¢ç„¶å¤–é¢çš„ä¸–ç•Œå¾ˆå±é™©ï¼Œæ˜¾ç„¶ä½ å¾—ç”¨ `unsafe` ä¸ä¹‹äº¤äº’ã€‚ é¦–å…ˆï¼Œè¯·ç¡®ä¿ä½ æ‹¥æœ‰æ­£ç¡®çš„æ¥å£ï¼Œä»¥å…ä½ åœ¨è°ƒè¯•æ—¶è¸©å‘ã€‚ [bindgen](https://github.com/rust-lang/rust-bindgen)ï¼ˆç”¨äºä» Rust è®¿é—® C ï¼‰å’Œ[cbindgen](https://github.com/eqrion/cbindgen/)ï¼ˆç”¨äºä» C è®¿é—® Rustï¼‰çš„å·¥å…·ç®±å°±æ˜¾å¾—éå¸¸æœ‰ç”¨ã€‚ å¦‚æœä½ ä» C ( ä½¿ç”¨Cæ¥å£çš„C++ ) è®¿é—® Rustï¼Œè¯·æ³¨æ„å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶å°†Rustå¯¹è±¡çš„ç”Ÿå­˜æœŸä¿ç•™åœ¨Rustä»£ç ä¸­-ä¹Ÿå°±æ˜¯è¯´ï¼Œè®©Ruståˆ é™¤å®ƒä»¬; è€Œå¯¹äº C çš„æŒ‡é’ˆï¼Œå°±è®© C å¤„ç†å®ƒä»¬ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼ŒRust æœ‰éå¸¸ç‰¹æ®Šçš„ç®¡ç†ç”Ÿå‘½å‘¨æœŸçš„æ–¹æ³•ï¼Œè®°ä½ä½ çš„éœ€æ±‚ã€‚

 å¦ä¸€æ–¹é¢ï¼Œå¦‚æœå°† Cï¼ˆ(æˆ–æ˜¯C++ ä½¿ç”¨äº† `extern` ) åŒ…è£…åœ¨Rustä¸­ï¼Œåˆ™ä¼šå‘ç° C åº“é€šå¸¸è¿˜éœ€è¦è€ƒè™‘æ•°æ®çš„ç”Ÿå‘½å‘¨æœŸã€‚ä¸€æ—¦æœ‰äº†ç»‘å®šï¼Œå°±å°è¯•è€ƒè™‘ç±»å‹çš„ç”Ÿå‘½å‘¨æœŸçš„é—®é¢˜ã€‚ unofficial patterns book æœ‰è¿™æ ·ä¸€ç«  [instructive chapter](https://rust-unofficial.github.io/patterns/patterns/ffi-intro.html)  ã€‚

å¦‚æœä¸ C++ äº¤äº’ï¼Œéœ€è¦ä½¿ç”¨ [cxx](https://docs.rs/cxx) ã€‚ä½†æ˜¯ï¼Œè¯·æ³¨æ„ï¼Œä¸é€šå¸¸çš„ `bindings generators` ä¸åŒï¼Œ`cxx` ä¸ä¼šç”¨ `unsafe` æ ‡è®°ä½ çš„å‡½æ•° ï¼æˆ‘åœ¨è¿™é‡Œçš„çœ‹æ³•æ˜¯ï¼Œç»‘å®šæœºåˆ¶éƒ¨åˆ†æ˜¯åœ¨ Rust ä¸­æ„å»ºçš„ï¼Œä¸€éƒ¨åˆ†æ˜¯åœ¨ C++ ä¸­æ„å»ºçš„ï¼Œå®ƒæ˜¯å¦æ˜¯ `safe` çš„ï¼Œè¿™å–å†³äºä½ å®¡æŸ¥ C++ çš„ä»£ç ã€‚ä½ å¯èƒ½ä»ç„¶å¸Œæœ›å°†ç»“æœæ¥å£åŒ…è£…åœ¨ä¸€ä¸ªå‹å¥½çš„æ¥å£ä¸­ï¼Œå¹¶ä¸”ä¸ä¼šä»¥ä¸å®‰å…¨çš„æ–¹å¼è¢«æ»¥ç”¨ã€‚ 



## ç¼–å†™ `unsafe rust` çš„å·¥å…· 


æ­£å¦‚æˆ‘ä»¬æ‰€è§ï¼Œç¼–å†™ `unsafe` Rustæ¯” `safe` çš„ Rust éœ€è¦å¤šåšè®¸å¤šå·¥ä½œï¼Œå› ä¸ºè¿™æ ·å°†ä¸å†ä¾é ç¼–è¯‘å™¨æ£€æŸ¥ã€‚ å› æ­¤ï¼Œè¦è¸ä¸Šè¿™æ¡é“è·¯ï¼Œæœ€å¥½å…ˆ"å¸¦ä¸Š"ä¸‹é¢çš„è¿™äº›å·¥å…·ï¼š



###ã€€Miri

[Miri ](https://github.com/rust-lang/miri)æ˜¯ `Rustc` çš„ MIR (ä¸­çº§ä¸­é—´è¯­è¨€)ï¼Œè¿™æ˜¯ Rust åœ¨ç§»äº¤ç»™ `LLVM` æˆ–è€…`Cranelift`ä¹‹å‰ç”¨æ¥ä¼˜åŒ–ç¨‹åºçš„ä¸­é—´è¡¨ç¤ºï¼Œæ˜¯ä¸€ç§è§£é‡Šå™¨ã€‚ ä½ å¯ä»¥ç”¨ `rustup` è¿è¡Œ `rustup component add miri` å®‰è£…å®ƒã€‚ å®ƒè·‘åœ¨  `cargo miri` ä¸Š-ä¾‹å¦‚ï¼Œ` cargo miri test` å°†åœ¨è§£é‡Šå™¨ä¸­è¿è¡Œæµ‹è¯•ã€‚ Miri é‡‡ç”¨äº†å¾ˆå¤šå¯ä»¥æ£€æµ‹æœªå®šä¹‰è¡Œä¸ºçš„æŠ€æœ¯ï¼Œä¾‹å¦‚è®¿é—®æœªåˆå§‹åŒ–çš„æ•°æ®ï¼Œå¹¶ä¼šæŒ‡å‡ºé—®é¢˜æ‰€åœ¨ã€‚ ä½†æ˜¯ï¼Œå®ƒåªä¼šåœ¨è¢«æ‰§è¡Œçš„ä»£ç ä¸Šæ£€æµ‹æœªå®šä¹‰è¡Œä¸ºï¼Œå› æ­¤ä¸èƒ½å®Œæ•´çš„è¦†ç›–ä»£ç ã€‚ 

 

### Clippy and Rust lints



Rustçš„å®˜æ–¹ lints (é™æ€åˆ†æå·¥å…·) ä¸­æœ‰å¾ˆå¤šå¯¹ç¼–å†™ `unsafe`  æœ‰å¸®åŠ©çš„ lintã€‚ è‡³å°‘ï¼Œmissing_safety_docsæ£‰ç»’å°†å¸®åŠ©æ‚¨å°†æ‰€æœ‰ä¸å®‰å…¨æ–¹æ³•çš„è¦æ±‚è®°å½•åœ¨æ¡ˆã€‚ å¦å¤–ï¼ŒRustç¼–è¯‘å™¨é»˜è®¤æƒ…å†µä¸‹ä¸ä¼šæ¿€æ´»æ‰€æœ‰æ£‰ç»’ï¼› è‡´ç”µrustc -W helpå°†æ˜¾ç¤ºæœ€æ–°åˆ—è¡¨ã€‚

### Prusti

[Prusti](https://github.com/viperproject/prusti-dev)  ä»åœ¨å¼€å‘ä¸­ï¼ˆç›®å‰åœ¨æ›´æ–°åˆ°æœ€æ–°çš„ç¨³å®šRustæ—¶å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œå› æ­¤æœ€æ–°çš„ç¨³å®šç‰ˆæœ¬é’ˆå¯¹æŸäº›2018 Rustç¼–è¯‘å™¨ï¼‰ï¼Œä½†æ˜¯è¿™ä¸ªå·¥å…·éå¸¸æœ‰å‰æ™¯ï¼Œå¯è®©ä½ åœ¨æ•°å­¦ä¸ŠéªŒè¯ç»™å®šç‰¹å®šæ¡ä»¶çš„ä»£ç çš„å®‰å…¨æ€§ã€‚

åŸºæœ¬ä¸Šï¼Œä½ å¯ä»¥ç”¨æ•°å­¦è¯æ˜ä»£ç ä¸­æŸäº›ä¸å˜é‡æ˜¯ "çœŸçš„" ä¿æŒä¸å˜çš„ï¼Œè¿™å¯¹äºå¿…é¡»æ”¯æŒä¸å®‰å…¨ä»£ç çš„ä¸å˜é‡çš„å®‰å…¨æŠ½è±¡æ˜¯ç†æƒ³çš„ã€‚ æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§[ç”¨æˆ·æŒ‡å—](https://viperproject.github.io/prusti-dev/user-guide/)ã€‚



### Fuzzers

[Rust Fuzz Book](https://rust-fuzz.github.io/book/) åˆ—å‡ºäº†è®¸å¤šå¯ä¸Rustä¸€èµ·ä½¿ç”¨çš„ `Fuzzer` (æ¨¡ç³Šæµ‹è¯•å™¨)ã€‚ç›®å‰ï¼Œå¯ä½¿ç”¨çš„`Fuzzer` æœ‰ [cargo-fuzz/libfuzzer](https://github.com/rust-fuzz/cargo-fuzz) å’Œ [American Fuzzy Lop / afl.rs](http://lcamtuf.coredump.cx/afl/)çš„ã€‚ä¸¤è€…éƒ½å°†ä¸ºçš„ä»£ç åˆ›å»ºå¤§é‡çš„æµ‹è¯•è¾“å…¥ï¼Œå¹¶è¿è¡Œå®ƒä»¥æŸ¥æ‰¾è§¦å‘å´©æºƒçš„æŸç§ç»„åˆã€‚

> è¯‘è€…æ³¨: è¿™ä¸ªåœ°æ–¹çš„ Fuzzer æ˜¯å®‰å…¨æµ‹è¯•é‡Œé¢å¸¸ç”¨çš„æ¨¡ç³Šæµ‹è¯•å·¥å…·, å¸¸è§çš„å°±æ˜¯ä¸Šæ–‡æåˆ°çš„AFL ã€‚è€Œè¿™ç§éšæœºç”Ÿæˆçš„æµ‹è¯•æ ·ä¾‹è¢«ç”¨äºä¿è¯ä»£ç è¦†ç›–ç‡, æ¯å½“é‡åˆ° crash (å´©æºƒçš„æ ·ä¾‹) å¹¶ä¼šè®°å½•ä¸‹, æç¤ºæ­¤å¤„å¯èƒ½æœ‰æ¼æ´ã€‚

ä¸ºäº†æ£€æµ‹æœªåˆå§‹åŒ–å†…å­˜çš„ä½¿ç”¨ï¼Œ[libdiffuzz](https://github.com/Shnatsel/libdiffuzz)æ˜¯ä¸€ä¸ªä¾µå…¥å¼å†…å­˜åˆ†é…å™¨ï¼Œå®ƒå°†ä½¿ç”¨ä¸åŒçš„å€¼æ¥åˆå§‹åŒ–æ¯ä¸ªå†…å­˜åˆ†é…ã€‚é€šè¿‡è¿è¡Œä¸¤æ¬¡ä»£ç å¹¶æ¯”è¾ƒç»“æœï¼Œå¯ä»¥ç¡®å®šæœªåˆå§‹åŒ–å†…å­˜çš„å“ªä¸€éƒ¨åˆ†æ˜¯é€ æˆäº†é—®é¢˜ã€‚æ›´ä¸é”™çš„æ˜¯ï¼Œ`memory sanitizer`  æ˜¯æ¯å¤©æ›´æ–°çš„ï¼ˆ[tracking lssue](https://github.com/rust-lang/rust/issues/39699)åˆ—å‡ºäº†å„ç§`memory sanitizer`åŠå…¶åœ¨å„ä¸ªå¹³å°ä¸Šçš„æ”¯æŒï¼‰ï¼Œä¼šç›‘æµ‹æ¯ä¸€æ¬¡å¯¹æœªåˆå§‹åŒ–å†…å­˜çš„è¯»å–ï¼Œå“ªæ€•æ²¡æœ‰é€ æˆä»»ä½•é—®é¢˜ã€‚ 

å°½ç®¡ä»ç»Ÿè®¡å­¦ä¸Šè®²ï¼Œ `Fuzzer` æ¯”æ™®é€šçš„å±æ€§æµ‹è¯•æ›´æœ‰å¯èƒ½æ‰¾åˆ°ä»£ç è·¯å¾„ï¼Œä½†ä¸èƒ½ä¿è¯ä»–ä»¬ä¼šåœ¨ä»»ä½•æ—¶é—´åæ‰¾åˆ°ç‰¹å®šçš„ä»£ç è·¯å¾„ã€‚æ¯”å¦‚è¯´æˆ‘æ›¾ç»é‡åˆ°çš„æ ‡è®°åŒ–å‡½æ•°çš„ `bug`ï¼Œå°±æ˜¯ç”±æˆ‘åœ¨äº’è”ç½‘ä¸Šçš„ä¸€ä¸ªéšæœºæ–‡æ¡£ä¸­å‘ç°çš„ä¸€ä¸ª `unicode` å®½çš„ç©ºæ ¼è§¦å‘çš„ï¼Œå½“åœ¨è¿è¡Œäº†æ•°åäº¿ä¸ªæµ‹è¯•æ¡ˆä¾‹çš„æ¨¡ç³Šæµ‹è¯•ä¸€å‘¨åä¹Ÿå¹¶æœªå‘ç°ã€‚Rust fuzz åœ¨ [trophy case](https://github.com/rust-fuzz/trophy-case) ä¸Šå±•ç¤ºäº†ä¸å°‘æ²¡è¢« Fuzzing åˆ°çš„ `bug`ã€‚å¦‚æœä½ æ‰¾åˆ°ä¸€ä¸ªåŒæ ·çš„ `bug` ï¼Œè¯·æ·»åŠ å®ƒã€‚

> è¯‘è€…æ³¨: Fuzzer ä¸ä¿è¯100%çš„ä»£ç è¦†ç›–ç‡, å› ä¸ºç§å­æ˜¯éšæœºçš„

 [rutenspitz](https://github.com/jakubadamw/rutenspitz) æ˜¯ä¸€ä¸ªè¿‡ç¨‹å®ï¼Œéå¸¸é€‚åˆå¯¹çŠ¶æ€ä»£ç ï¼ˆä¾‹å¦‚æ•°æ®ç»“æ„ï¼‰è¿›è¡Œæ¨¡å‹æµ‹è¯•ã€‚æ¨¡å‹æµ‹è¯•æ„å‘³ç€æ‚¨æ‹¥æœ‰ä¸€ä¸ª â€œæ¨¡å‹â€ ï¼Œå³ä¸€ä¸ªç®€å•ä½†ç¼“æ…¢çš„ç‰ˆæœ¬ï¼Œå¯ä»¥å¯¹è¦ç¡®ä¿çš„è¡Œä¸ºè¿›è¡Œå»ºæ¨¡ï¼Œç„¶åä½¿ç”¨å®ƒæ¥æµ‹è¯•ä¸å®‰å…¨çš„å®ç°ã€‚ç„¶åå®ƒå°†ç”Ÿæˆä¸€ç³»åˆ—æ“ä½œï¼Œä»¥æµ‹è¯•ç›¸ç­‰å…³ç³»æ˜¯å¦æˆç«‹ã€‚å¦‚æœä½ éµå¾ªäº†æˆ‘çš„ä¸Šè¿°å»ºè®®ï¼Œåˆ™åº”è¯¥å·²ç»æœ‰ä¸€ä¸ªå®‰å…¨çš„å®æ–½æ–¹æ¡ˆå¯ä»¥è¿›è¡Œæµ‹è¯•ã€‚ 

##  [LogRocket](https://logrocket.com/signup): Full visibility into production Rust apps
(å¹¿å‘Šæ—¶é—´åˆ°) è°ƒè¯• Rust åº”ç”¨ç¨‹åºæ˜¯è‰°è¾›çš„ï¼Œå½“æˆ‘ä»¬é‡åˆ°éš¾ä»¥é‡ç°çš„é—®é¢˜æ—¶æ›´æ˜¯å¦‚æ­¤ã€‚ å¦‚æœå¸Œæœ›ç›‘è§†å’Œè·Ÿè¸ª Rust åº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼Œè‡ªåŠ¨æ˜¾ç¤ºé”™è¯¯ä»¥åŠè·Ÿè¸ªç¼“æ…¢çš„ç½‘ç»œè¯·æ±‚å’ŒåŠ è½½æ—¶é—´ï¼Œè¯·å°è¯• [LogRocket](https://logrocket.com/signup)ã€‚ 



![](../image/unsafe_rust.png)



`LogRocket` å°±åƒWebåº”ç”¨ç¨‹åºä¸­çš„ `DVR` ï¼Œå®é™…ä¸Šè®°å½•äº† Rust åº”ç”¨ç¨‹åºä¸­å‘ç”Ÿçš„æ‰€æœ‰äº‹æƒ…ã€‚ å®ƒå¯ä»¥æ±‡æ€»å¹¶æŠ¥å‘Šé—®é¢˜å‘ç”Ÿæ—¶åº”ç”¨ç¨‹åºæ‰€å¤„çš„çŠ¶æ€ï¼Œè€Œä¸ç”¨çŒœæµ‹ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿé—®é¢˜ã€‚ `LogRocket` è¿˜ä¼šç›‘è§†åº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼ŒæŠ¥å‘Šè¯¸å¦‚å®¢æˆ·ç«¯CPUè´Ÿè½½ï¼Œå®¢æˆ·ç«¯å†…å­˜ä½¿ç”¨æƒ…å†µç­‰æŒ‡æ ‡ã€‚ 

èµ°ä¸€æ¡ rust debug ç°ä»£åŒ–ä¹‹è·¯å§!  [ç‚¹å‡»å³ç”¨](https://logrocket.com/signup).


